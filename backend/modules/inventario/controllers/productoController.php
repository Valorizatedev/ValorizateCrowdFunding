<?phpclass productoController extends Controller {    private $_producto;    private $_impuesto;    private $_config;    public function __construct() {        parent::__construct();        $this->_producto = $this->loadModel('producto', 'inventario');        $this->_impuesto = $this->loadModel('impuesto', 'admin');        $this->_config = $this->loadModel('config','admin');    }    public function index($pagina = false) {        $this->_acl->acceso('ver_producto');                $this->_view->setJs(array('ajax'));        $this->_view->assign('titulo', 'Administraci&oacute;n de Productos');        $condicion = 'pro_estado!=0';        $productos = $this->_producto->consultar($condicion);        $this->_view->assign('productos', $productos);        $this->_view->renderizar('index', 'producto');    }    public function nuevo() {        $this->_acl->acceso('crear_producto');        $this->_view->assign('titulo', 'Registrar Producto');            if ($this->getInt('guardar') == 1) {            $this->_view->assign('datos', $_POST);            $datos = array(                'pro_nombre' => $this->getTexto('nombre'),                'pro_descripcion' => $this->getTexto('descripcion'),                'pro_valor' => str_replace(".", "", $this->getTexto('valor')),                'pro_cantidad' => str_replace(".", "", $this->getTexto('cantidad')),                'pro_valor_venta' => str_replace(".", "", $this->getTexto('valor_cliente')),                'pro_referencia' => $this->getTexto('referencia'),            );                        $this->_producto->crear($datos);			$this->redireccionar('inventario/producto',   'Producto creado con exito',3);        }        $this->_view->renderizar('nuevo', 'producto');    }    public function detalles($id) {        $this->_acl->acceso('ver_producto');        $this->_view->assign('titulo', 'Administracion de Productos');        $condicion = "pro_key={$id}";        $productos = $this->_producto->consultar($condicion);        $this->_view->assign('productos', $productos[0]);                $this->_view->renderizar('detalles', 'producto');    }    public function editar($id) {        $this->_acl->acceso('modificar_producto');        $this->_view->assign('titulo', 'Actualizar Productos');        $condicion = "pro_key={$id}";        $productos = $this->_producto->consultar($condicion);        $this->_view->assign('productos', $productos[0]);                if ($this->getInt('guardar') == 1) {            $datos = array(                'pro_nombre' => $this->getTexto('nombre'),                'pro_descripcion' => $this->getTexto('descripcion'),                'pro_valor' => str_replace(".", "", $this->getTexto('valor')),                'pro_cantidad' => str_replace(".", "", $this->getTexto('cantidad')),                'pro_valor_venta' => str_replace(".", "", $this->getTexto('valor_cliente')),                'pro_referencia' => $this->getTexto('referencia')            );            $this->_producto->actulizar($id, $datos);            $this->_view->assign('_mensaje', "El producto '{$this->getTexto('nombre')}' fue actualizado exitosamente");            $condicion = "pro_key={$id}";            $productos = $this->_producto->consultar($condicion);            $this->_view->assign('productos', $productos[0]);            $this->redireccionar('inventario/producto',   'Producto editado con exito',3);        }        $this->_view->renderizar('editar', 'producto');    }    public function eliminar($id) {        $this->_acl->acceso('eliminar_producto');        $this->_view->assign('titulo', 'Eliminar Producto');        $this->_producto->eliminar($id);      //  $this->redireccionar('admin/producto');        $this->redireccionar('inventario/producto',   'Producto eliminado con exito',2);    }    public function consultaAjax() {        if ($this->getTexto('valor')) {            $condicion = "(UPPER(pro_nombre) like UPPER('%{$this->getTexto('valor')}%') OR                UPPER(pro_referencia) like UPPER('%{$this->getTexto('valor')}%')) AND pro_estado!='0'";            echo json_encode($this->_producto->consultar($condicion));        }    }    public function menos()    {        $this->_acl->acceso('ver_producto');                $this->_view->assign('titulo', 'Administraci&oacute;n de Productos');        $condicion = 'config_key=1';        $valorminimo = $this->_config->consultar($condicion);        $valorminimo=$valorminimo[0]['config_cantiad_articulos'];        $condicion = 'pro_estado!=0 and pro_cantidad<'.$valorminimo;        $productos = $this->_producto->consultar($condicion);        $this->_view->assign('productos', $productos);        $this->_view->renderizar('menos', 'producto');    }}?>